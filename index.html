<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arbeitsplan</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js"></script>
    <script>
        // Firebase Konfiguration
        const firebaseConfig = {
            apiKey: "AIzaSyBhxf0A_Ks-QNWyn9BC_aFIpa-FNiRnL3E",
            authDomain: "arbeitsplan-f8b81.firebaseapp.com",
            databaseURL: "https://arbeitsplan-f8b81-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "arbeitsplan-f8b81",
            storageBucket: "arbeitsplan-f8b81.firebasestorage.app",
            messagingSenderId: "245771353059",
            appId: "1:245771353059:web:e8b61cac54ff600c5dbed6"
        };

        // Firebase initialisieren
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Firebase Database Helper Functions
        class FirebaseDB {
            constructor() {
                this.db = database;
            }

            // Speichere Daten in Firebase
            async saveData(path, data) {
                try {
                    await this.db.ref(path).set(data);
                    console.log('Daten erfolgreich gespeichert:', path);
                    return true;
                } catch (error) {
                    console.error('Fehler beim Speichern:', error);
                    return false;
                }
            }

            // Lade Daten aus Firebase
            async loadData(path) {
                try {
                    const snapshot = await this.db.ref(path).once('value');
                    if (snapshot.exists()) {
                        return snapshot.val();
                    } else {
                        console.log('Keine Daten gefunden für:', path);
                        return null;
                    }
                } catch (error) {
                    console.error('Fehler beim Laden:', error);
                    return null;
                }
            }

            // Lösche Daten aus Firebase
            async deleteData(path) {
                try {
                    await this.db.ref(path).remove();
                    console.log('Daten erfolgreich gelöscht:', path);
                    return true;
                } catch (error) {
                    console.error('Fehler beim Löschen:', error);
                    return false;
                }
            }

            // Speichere Mitarbeiter
            async saveEmployees(employees) {
                return await this.saveData('employees', employees);
            }

            // Lade Mitarbeiter
            async loadEmployees() {
                const data = await this.loadData('employees');
                return data || [];
            }

            // Speichere Zuweisungen
            async saveAssignments(assignments) {
                return await this.saveData('assignments', assignments);
            }

            // Lade Zuweisungen
            async loadAssignments() {
                const data = await this.loadData('assignments');
                return data || {};
            }

            // Speichere Mitarbeiter Startdaten
            async saveEmployeeStartDates(dates) {
                return await this.saveData('employeeStartDates', dates);
            }

            // Lade Mitarbeiter Startdaten
            async loadEmployeeStartDates() {
                const data = await this.loadData('employeeStartDates');
                return data || {};
            }

            // Speichere Mitarbeiter Enddaten
            async saveEmployeeEndDates(dates) {
                return await this.saveData('employeeEndDates', dates);
            }

            // Lade Mitarbeiter Enddaten
            async loadEmployeeEndDates() {
                const data = await this.loadData('employeeEndDates');
                return data || {};
            }

            // Speichere Zell-Notizen
            async saveCellNotes(notes) {
                return await this.saveData('cellNotes', notes);
            }

            // Lade Zell-Notizen
            async loadCellNotes() {
                const data = await this.loadData('cellNotes');
                return data || {};
            }

            // Speichere Zell-Links
            async saveCellLinks(links) {
                return await this.saveData('cellLinks', links);
            }

            // Lade Zell-Links
            async loadCellLinks() {
                const data = await this.loadData('cellLinks');
                return data || {};
            }

            // Speichere Zell-Adressen
            async saveCellAddresses(addresses) {
                return await this.saveData('cellAddresses', addresses);
            }

            // Lade Zell-Adressen
            async loadCellAddresses() {
                const data = await this.loadData('cellAddresses');
                return data || {};
            }

            // Lade alle Daten
            async loadAllData() {
                try {
                    const [employees, assignments, employeeStartDates, employeeEndDates, cellNotes, cellLinks, cellAddresses] = await Promise.all([
                        this.loadEmployees(),
                        this.loadAssignments(),
                        this.loadEmployeeStartDates(),
                        this.loadEmployeeEndDates(),
                        this.loadCellNotes(),
                        this.loadCellLinks(),
                        this.loadCellAddresses()
                    ]);

                    return {
                        employees,
                        assignments,
                        employeeStartDates,
                        employeeEndDates,
                        cellNotes,
                        cellLinks,
                        cellAddresses
                    };
                } catch (error) {
                    console.error('Fehler beim Laden aller Daten:', error);
                    return {
                        employees: [],
                        assignments: {},
                        employeeStartDates: {},
                        employeeEndDates: {},
                        cellNotes: {},
                        cellLinks: {},
                        cellAddresses: {}
                    };
                }
            }

            // Speichere alle Daten
            async saveAllData(data) {
                try {
                    await Promise.all([
                        this.saveEmployees(data.employees),
                        this.saveAssignments(data.assignments),
                        this.saveEmployeeStartDates(data.employeeStartDates),
                        this.saveEmployeeEndDates(data.employeeEndDates),
                        this.saveCellNotes(data.cellNotes),
                        this.saveCellLinks(data.cellLinks),
                        this.saveCellAddresses(data.cellAddresses)
                    ]);
                    return true;
                } catch (error) {
                    console.error('Fehler beim Speichern aller Daten:', error);
                    return false;
                }
            }
        }

        // Erstelle eine globale Instanz
        window.firebaseDB = new FirebaseDB();

        // Überprüfe, ob der Benutzer eingeloggt ist
        window.onload = function() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if (!currentUser) {
                window.location.href = 'login.html';
            }
        }
    </script>
</head>
<body>
    <div class="container">
        <header>
            <h1>Arbeitsplan</h1>
            <button id="logoutButton" class="logout-button">Ausloggen</button>
        </header>

        <div class="calendar-header">
            <div id="yearGrid" class="year-grid"></div>
            <div id="monthGrid" class="month-grid"></div>
        </div>

        <div class="status-buttons">
            <button class="status-button" data-status="urlaub">Urlaub</button>
            <button class="status-button" data-status="krank">Krankheit</button>
            <button class="status-button" data-status="unbezahlt">Unbezahlter Urlaub</button>
            <button class="status-button" data-status="schulung">Schule</button>
            <button class="status-button" data-status="feiertag">Feiertag</button>
            <button class="status-button" data-status="kurzarbeit">Kurzarbeit</button>
            <button id="clearSelection">Auswahl löschen</button>
        </div>

        <div id="infoField" class="info-field">
            <h3>Notizen</h3>
            <textarea id="infoText" placeholder="Notizen eingeben..."></textarea>
            <div class="link-input">
                <input type="text" id="linkInput" placeholder="Link eingeben...">
                <button id="openLinkFolder" class="open-folder-btn">Ordner öffnen</button>
            </div>
            <div class="address-input">
                <input type="text" id="addressInput" placeholder="Adresse eingeben...">
                <button id="openMaps" class="maps-btn">Adresse in Maps öffnen</button>
            </div>
        </div>

        <div class="calendar-container">
            <table class="calendar">
                <thead>
                    <tr id="headerRow"></tr>
                </thead>
                <tbody id="calendarBody"></tbody>
            </table>
        </div>

        <div class="bottom-buttons">
            <button id="addEmployee">Mitarbeiter hinzufügen</button>
            <button id="exportData">Daten exportieren</button>
            <input type="file" id="importData" accept=".json" style="display: none;">
            <button id="importDataBtn">Daten importieren</button>
        </div>
    </div>

    <!-- Modal für neue Mitarbeiter -->
    <div id="employeeModal" class="modal">
        <div class="modal-content">
            <h2>Mitarbeiter hinzufügen</h2>
            <input type="text" id="employeeName" placeholder="Name des Mitarbeiters">
            <button id="saveEmployee">Speichern</button>
            <button id="cancelEmployee">Abbrechen</button>
        </div>
    </div>

    <!-- Modal für Mitarbeiter löschen -->
    <div id="deleteEmployeeModal" class="modal">
        <div class="modal-content">
            <h2>Mitarbeiter entfernen</h2>
            <p>Möchten Sie den Mitarbeiter <span id="employeeToDelete"></span> wirklich entfernen?</p>
            <button id="confirmDelete">Ja</button>
            <button id="cancelDelete">Nein</button>
        </div>
    </div>

    <!-- Modal für Export -->
    <div id="exportModal" class="modal">
        <div class="modal-content">
            <h2>Daten exportieren</h2>
            <div class="export-options">
                <div class="export-range">
                    <h3>Export-Bereich</h3>
                    <div class="radio-group">
                        <label>
                            <input type="radio" name="exportRange" value="currentMonth" checked>
                            Aktuellen Monat exportieren
                        </label>
                        <label>
                            <input type="radio" name="exportRange" value="all">
                            Gesamten Plan exportieren
                        </label>
                    </div>
                </div>
                <div class="export-formats">
                    <h3>Dateiformate</h3>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" name="exportFormat" value="json" checked>
                            JSON-Datei
                        </label>
                        <label>
                            <input type="checkbox" name="exportFormat" value="excel" checked>
                            Excel-Datei
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-buttons">
                <button id="confirmExport">Exportieren</button>
                <button id="cancelExport">Abbrechen</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html> 