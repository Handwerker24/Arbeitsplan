<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arbeitsplan</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <!-- Firebase SDK v8 -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script>
        // Überprüfe, ob der Benutzer eingeloggt ist
        window.onload = function() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if (!currentUser) {
                window.location.href = 'login.html';
            } else {
                // Stelle sicher, dass Firebase Auth aktiv ist (für Security Rules)
                if (typeof firebase !== 'undefined' && firebase.auth) {
                    // Prüfe, ob bereits authentifiziert
                    firebase.auth().onAuthStateChanged(function(authUser) {
                        if (!authUser) {
                            // Versuche anonyme Authentifizierung für Security Rules
                            firebase.auth().signInAnonymously().catch(function(error) {
                                console.warn('Anonyme Authentifizierung fehlgeschlagen:', error);
                            });
                        }
                    });
                }
            }
        }
    </script>
</head>
<body>
    <div class="container">
        <header>
            <h1>Arbeitsplan</h1>
            <button id="logoutButton" class="logout-button">Ausloggen</button>
        </header>

        <div class="calendar-header">
            <div id="yearGrid" class="year-grid"></div>
            <div id="monthGrid" class="month-grid"></div>
        </div>

        <div class="status-buttons">
            <button class="status-button" data-status="urlaub">Urlaub</button>
            <button class="status-button" data-status="krank">Krankheit</button>
            <button class="status-button" data-status="unbezahlt">Unbezahlter Urlaub</button>
            <button class="status-button" data-status="schulung">Schule</button>
            <button class="status-button" data-status="feiertag">Feiertag</button>
            <button class="status-button" data-status="kurzarbeit">Kurzarbeit</button>
            <button id="clearSelection">Auswahl löschen</button>
        </div>

        <!-- Modal für Notizen (Popup) -->
        <div id="infoField" class="modal" style="display: none;">
            <div class="modal-content">
                <button id="closeInfoField" class="close-button-x">×</button>
                <h3>Notizen</h3>
                <textarea id="infoText" placeholder="Notizen eingeben..."></textarea>
                <div class="link-input">
                    <input type="text" id="linkInput" placeholder="Link eingeben...">
                    <button id="openLinkFolder" class="open-folder-btn">Ordner öffnen</button>
                </div>
                <div class="address-input">
                    <input type="text" id="addressInput" placeholder="Adresse eingeben...">
                    <button id="openMaps" class="maps-btn">Adresse in Maps öffnen</button>
                </div>
            </div>
        </div>

        <div class="calendar-container">
            <table class="calendar">
                <thead>
                    <tr id="headerRow"></tr>
                </thead>
                <tbody id="calendarBody"></tbody>
            </table>
        </div>

        <div class="bottom-buttons">
            <button id="addEmployee">Mitarbeiter hinzufügen</button>
            <button id="exportData">Daten exportieren</button>
            <input type="file" id="importData" accept=".json" style="display: none;">
            <button id="importDataBtn">Daten importieren</button>
            <button id="showEvaluation">Auswertung</button>
            <button id="showAuditLog">Änderungsprotokoll</button>
        </div>
    </div>

    <!-- Modal für neue Mitarbeiter -->
    <div id="employeeModal" class="modal">
        <div class="modal-content">
            <h2>Mitarbeiter hinzufügen</h2>
            <input type="text" id="employeeName" placeholder="Name des Mitarbeiters">
            <button id="saveEmployee">Speichern</button>
            <button id="cancelEmployee">Abbrechen</button>
        </div>
    </div>

    <!-- Modal für Mitarbeiter löschen -->
    <div id="deleteEmployeeModal" class="modal">
        <div class="modal-content">
            <h2>Mitarbeiter entfernen</h2>
            <p>Möchten Sie den Mitarbeiter <span id="employeeToDelete"></span> wirklich entfernen?</p>
            <button id="confirmDelete">Ja</button>
            <button id="cancelDelete">Nein</button>
        </div>
    </div>

    <!-- Modal für Auswertung -->
    <div id="evaluationModal" class="modal">
        <div class="modal-content" style="max-width: 90%; max-height: 90vh; overflow: auto;">
            <button id="closeEvaluation" class="close-button-x">×</button>
            <h2>Auswertung</h2>
            <div style="margin: 20px 0;">
                <label for="evaluationYear">Jahr auswählen:</label>
                <select id="evaluationYear" style="padding: 5px; margin-left: 10px;">
                    <!-- Wird dynamisch gefüllt -->
                </select>
                <button id="generateEvaluation" style="margin-left: 10px; padding: 5px 15px;">Auswertung generieren</button>
            </div>
            <div id="evaluationTable" style="margin-top: 20px;">
                <!-- Tabelle wird hier eingefügt -->
            </div>
        </div>
    </div>

    <!-- Modal für Export -->
    <div id="exportModal" class="modal">
        <div class="modal-content">
            <h2>Daten exportieren</h2>
            <div class="export-options">
                <div class="export-range">
                    <h3>Export-Bereich</h3>
                    <div class="radio-group">
                        <label>
                            <input type="radio" name="exportRange" value="currentMonth" checked>
                            Aktuellen Monat exportieren
                        </label>
                        <label>
                            <input type="radio" name="exportRange" value="all">
                            Gesamten Plan exportieren
                        </label>
                    </div>
                    <div id="yearSelection" style="display: none; margin-top: 15px;">
                        <label>
                            <strong>Jahr auswählen:</strong>
                            <select id="exportYear" style="margin-left: 10px; padding: 5px;">
                                <!-- Wird dynamisch gefüllt -->
                            </select>
                        </label>
                    </div>
                </div>
                <div class="export-formats">
                    <h3>Dateiformate</h3>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" name="exportFormat" value="json" checked>
                            JSON-Datei
                        </label>
                        <label>
                            <input type="checkbox" name="exportFormat" value="excel" checked>
                            Excel-Datei
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-buttons">
                <button id="confirmExport">Exportieren</button>
                <button id="cancelExport">Abbrechen</button>
            </div>
        </div>
    </div>

    <!-- Modal für Import-Rückgängig -->
    <div id="undoImportModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h2>Import erfolgreich</h2>
            <p>Daten wurden erfolgreich importiert!</p>
            <p>Möchten Sie die Änderung rückgängig machen?</p>
            <div class="modal-buttons">
                <button id="confirmUndo">Ja</button>
                <button id="cancelUndo">Nein</button>
            </div>
        </div>
    </div>

    <script src="firebase-simple.js"></script>
    <script src="script.js"></script>
</body>
</html> 